<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=diveci-width,initial-scale=1.0">
  <title>Steps</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
  <link rel="stylesheet" href="css/signup.css">
  <script src="/js/signup.js"></script>


</head>
<body>
  <!-- multistep form -->
  <form id="msform">
    <!-- progressbar -->
    <ul id="progressbar">
      <li class="active">Create<br>Your Account</li>
      <li>Choose Your<br>Eat Biuddy</li>
      <li>Confirm<br></li>
    </ul>
    <!-- fieldsets -->
    <fieldset id="field1">
      <h2 class="fs-title" style="padding: 20px ">Create your account</h2>
    <!--<h3 class="fs-subtitle">This is step 1</h3>-->
      <input type="text" class="name" name="username" placeholder="Username" />
      <input type="password" class="pw" name="pass" placeholder="Password" />
      <input type="password" name="cpass" placeholder="Confirm Password" />
      <input type="text" name="email" placeholder="Email" />
      <input id="next" type="button" name="next" class="next action-button" value="Next" />
      <h6 class="login_text" style="padding: 10px ">Already have an account?</h6>
      <a href="/"><h6 class="login_text" style="padding: 10px ">Login</h6></a>

    </fieldset>
    <fieldset>
      <h2 class="fs-title">Choose Your Eat Buddy</h2>
      <a class="avatar-btn avatar1-btn"><img id="img1" class="avatar-img" src="images/shiba-inu.png" alt="avatar" align="center"></a>
      <a class="avatar-btn avatar2-btn"><img id="img2" class="avatar-img" src="images/cat.png" alt="avatar" align="center"></a>
      <a class="avatar-btn avatar3-btn"><img id="img3" class="avatar-img" src="images/bulldog.png" alt="avatar" align="center"></a>
      <a class="avatar-btn avatar4-btn"><img id="img4" class="avatar-img" src="images/koala.png" alt="avatar" align="center"></a>

      <h2 class="fs-subtitle">Name your Eat Buddy</h2>
      <input type="text" name="eatBuddy" placeholder="Name" />
      <input type="button" name="previous" class="previous action-button" value="Back" />
      <input id="next2" type="button" name="next" class="next action-button" value="Next" />
    </fieldset>
    <fieldset>
      <h2 class="fs-title">Is this your Eat Buddy?</h2>
      <img id='user-avatar' class="avatar-confirm_img" src="{{imageSrc}}" alt="avatar" style="margin:30px 0px 20px 0px;">
      <h3 id="eatBuddy" class="fs-name">{{ eatBuddy }}</h3>
      <input type="button" name="previous" class="previous action-button" value="No" />
      <a href="home"><input type="submit" name="submit" class="submit action-button" value="Yes" onclick="redirect();"/></a>
    </fieldset>
  </form>
  <!-- partial -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script><script  src="js/signup.js"></script>
    <script type="text/javascript">
    function redirect()
      {
          location.href = "home";
      }
    function sendStep1Data() {
      console.log(1)

    }
    </script>

    <script>
      $(document).ready(function () {
        var eatBuddy = '';
        var name = '';
        var imageSrc = ''
        let mapImgSrc = {
          'img1': 'images/shiba-inu.png',
          'img2': 'images/cat.png',
          'img3': 'images/bulldog.png',
          'img4': 'images/koala.png'
        }
        $('#next').click(function() {
          var form = document.querySelector('form');
          var formData = new FormData(form);
          var reqData = {}
          for (var [key, value] of formData.entries()) {
            reqData[key] = value;
            if (key == 'username') {
              name = value
            }
          }
          console.log(name)
          $.ajax({
            type: "POST",
            url: '/signup_step1',
            data: reqData,
            success: function (res) {
              // let { step1 } = res;
              // console.log(step1);
              // eatBuddy = step1[name]['username']
              // $('#eatBuddy').html(eatBuddy)
            }
          });
        });

        $('#next2').click(function() {
          // var form = document.querySelector('form');
          // var formData = new FormData(form);
          // var reqData = {}
          // for (var [key, value] of formData.entries()) {
          //   reqData[key] = value;
          //   if (key == 'username') {
          //     name = value
          //   }
          // }
          var form = document.querySelector('form');
          var formData = new FormData(form);
          for (var [key, value] of formData.entries()) {
            if (key == 'eatBuddy') {
              eatBuddy = value
            }
          }
          $.ajax({
            type: "POST",
            url: '/signup_step2',
            data: {
              name,
              eatBuddy,
              imageId
            },
            success: function (res) {
              console.log(res);
              let { step2 } = res;
              imageSrc = mapImgSrc[step2[name]['imageId']]
              console.log(imageSrc)
              $('#user-avatar').attr('src', imageSrc)
              $('#eatBuddy').html(eatBuddy)
            }
          });
        });
      })
    </script>


  </body>
  </html>
